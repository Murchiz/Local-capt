<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
        x:Class="CaptionGenerator.Views.MainWindow"
        xmlns:vm="using:CaptionGenerator.ViewModels"
        x:DataType="vm:MainViewModel"
        Title="CaptionGenerator">
  <Design.DataContext>
    <vm:MainViewModel/>
  </Design.DataContext>
  <Window.Styles>
    <Style Selector="ListBoxItem">
      <Setter Property="Padding" Value="0"/>
    </Style>
    <Style Selector="Border.captionItem TextBox.captionText">
      <Setter Property="Opacity" Value="0.5"/>
      <Setter Property="Transitions">
        <Transitions>
          <DoubleTransition Property="Opacity" Duration="0:0:0.2"/>
        </Transitions>
      </Setter>
    </Style>
    <Style Selector="Border.captionItem:pointerover TextBox.captionText">
      <Setter Property="Opacity" Value="1.0"/>
    </Style>
    <Style Selector="Border.captionItem:pointerover">
      <Setter Property="Background" Value="#10FFFFFF"/>
    </Style>
  </Window.Styles>
  <DockPanel>
    <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Spacing="10" Margin="10">
      <Button Content="Select Folder" Command="{Binding SelectFolderCommand}"/>
      <ComboBox ItemsSource="{Binding PromptTemplates}"
                SelectedItem="{Binding SelectedPromptTemplate}"
                DisplayMemberBinding="{Binding Name}"
                Width="200"/>
      <TextBlock Text="Model:" VerticalAlignment="Center"/>
      <TextBlock Text="{Binding AssignedModelName}" VerticalAlignment="Center" FontWeight="Bold"/>
      <ToggleButton Content="Create Dataset" IsChecked="{Binding CreateDataset}" Margin="10,0"/>
      <Button Content="Settings" Command="{Binding OpenSettingsCommand}" HorizontalAlignment="Right"/>
    </StackPanel>
    <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" HorizontalAlignment="Right" Margin="10">
      <ProgressBar IsIndeterminate="True" IsVisible="{Binding IsBusy}" Width="200" Margin="5"/>
      <Button Content="Generate Captions" Command="{Binding GenerateCaptionsCommand}" IsEnabled="{Binding !IsBusy}" Margin="5"/>
      <ProgressBar IsIndeterminate="True" IsVisible="{Binding IsSaving}" Width="200" Margin="5"/>
      <Button Content="Save Captions" Command="{Binding SaveCaptionsCommand}" IsEnabled="{Binding !IsBusy}" Margin="5"/>
    </StackPanel>
    <ListBox ItemsSource="{Binding ImageCaptions}" Padding="10">
      <ListBox.ItemsPanel>
        <ItemsPanelTemplate>
          <WrapPanel />
        </ItemsPanelTemplate>
      </ListBox.ItemsPanel>
      <ListBox.ItemTemplate>
        <DataTemplate>
          <Border BorderThickness="2" CornerRadius="5" Padding="5" Margin="5"
                  BorderBrush="{Binding IsProcessing, Converter={StaticResource BoolToBrushConverter}}"
                  Background="Transparent" Classes="captionItem">
            <StackPanel Spacing="5">
              <Panel>
                <Image Source="{Binding ImagePath, Converter={StaticResource BitmapAssetValueConverter}}"
                       Width="200" Height="200" Margin="5"/>
                <Button Command="{Binding SaveCaptionCommand}"
                        IsVisible="{Binding IsModified}"
                        HorizontalAlignment="Right" VerticalAlignment="Top"
                        Margin="10" Padding="5"
                        Background="#80000000" Foreground="White"
                        ToolTip.Tip="Save Caption">
                  <PathIcon Data="M17,3H5C3.89,3 3,3.9 3,5V19C3,20.1 3.89,21 5,21H19C20.1,21 21,20.1 21,19V7L17,3M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M15,9H5V5H15V9Z" />
                </Button>
              </Panel>
              <TextBox Text="{Binding Caption}"
                       TextWrapping="Wrap" Width="200" Height="60"
                       AcceptsReturn="True"
                       Classes="captionText"/>
            </StackPanel>
          </Border>
        </DataTemplate>
      </ListBox.ItemTemplate>
    </ListBox>
  </DockPanel>
</Window>
