<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
        x:Class="CaptionGenerator.Views.MainWindow"
        xmlns:vm="using:CaptionGenerator.ViewModels"
        x:DataType="vm:MainViewModel"
        Title="CaptionGenerator">
  <Design.DataContext>
    <vm:MainViewModel/>
  </Design.DataContext>
  <DockPanel>
    <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Spacing="10" Margin="10">
      <Button Content="Select Folder" Command="{Binding SelectFolderCommand}"/>
      <ComboBox ItemsSource="{Binding PromptTemplates}"
                SelectedItem="{Binding SelectedPromptTemplate}"
                DisplayMemberBinding="{Binding Name}"
                Width="200"/>
      <TextBlock Text="Model:" VerticalAlignment="Center"/>
      <TextBlock Text="{Binding AssignedModelName}" VerticalAlignment="Center" FontWeight="Bold"/>
      <ToggleButton Content="Create Dataset" IsChecked="{Binding CreateDataset}" Margin="10,0"/>
      <Button Content="Settings" Command="{Binding OpenSettingsCommand}" HorizontalAlignment="Right"/>
    </StackPanel>
    <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" HorizontalAlignment="Right" Margin="10">
      <ProgressBar IsIndeterminate="True" IsVisible="{Binding IsBusy}" Width="200" Margin="5"/>
      <Button Content="Generate Captions" Command="{Binding GenerateCaptionsCommand}" IsEnabled="{Binding !IsBusy}" Margin="5"/>
      <ProgressBar IsIndeterminate="True" IsVisible="{Binding IsSaving}" Width="200" Margin="5"/>
      <Button Content="Save Captions" Command="{Binding SaveCaptionsCommand}" IsEnabled="{Binding !IsBusy}" Margin="5"/>
    </StackPanel>
    <ListBox ItemsSource="{Binding ImageCaptions}">
      <ListBox.ItemTemplate>
        <DataTemplate>
          <Border BorderThickness="2" CornerRadius="5" Padding="5" Margin="5"
                  BorderBrush="{Binding IsProcessing, Converter={StaticResource BoolToBrushConverter}}">
            <StackPanel Spacing="5">
              <!-- âš¡ Bolt Optimization: Use BitmapAssetValueConverter to decode image to 200px width, saving massive memory -->
              <Image Source="{Binding ImagePath, Converter={StaticResource BitmapAssetValueConverter}}" Width="200" Height="200" Margin="5"/>
              <TextBox Text="{Binding Caption}" IsReadOnly="True" TextWrapping="Wrap" Width="200"/>
            </StackPanel>
          </Border>
        </DataTemplate>
      </ListBox.ItemTemplate>
    </ListBox>
  </DockPanel>
</Window>
